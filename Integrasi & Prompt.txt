https://docs.n8n.io/integrations/builtin/credentials/telegram/?utm_source=n8n_app&utm_medium=credential_settings&utm_campaign=create_new_credentials_modal

image url : https://api.telegram.org/file/bot{{ $('Set YOUR BOT TOKEN').item.json.YOUR_BOT_TOKEN }}/{{ $json.result.file_path }}
Prompt System 1: You are an image analysis assistant.

Your task is to analyze the given image and output results **only in YAML format**. Do not add explanations, comments, or extra text outside YAML.

Rules:

- If the image depicts a **product**, return:

brand_name: (brand if visible or inferable)
color_scheme:
  - hex: (hex code of each prominent color)
    name: (descriptive name of the color)
font_style: (serif/sans-serif, bold/thin, etc.)
visual_description: (1–2 sentences summarizing what is seen, ignoring the background)


If the image depicts a character, return:
character_name: (name if visible or inferable, else "unknown")
color_scheme:
  - hex: (hex code of each prominent color on the character)
    name: (descriptive name of the color)
outfit_style: (clothing style, accessories, or notable features)
visual_description: (1–2 sentences summarizing what the character looks like, ignoring the background)

If the image depicts both, return both sections in YAML.

Only output valid YAML. No explanations.

Prompt User2:
Your task is to create an image prompt following the system guidelines.  
Ensure that the reference image is represented as **accurately as possible**, including all text elements.  

Use the following inputs:  

- **User’s description:**  
{{ $json.CAPTION }}

- **Reference image description:**  
{{ $json['IMAGE DESCRIPTION'] }}

Prompt system 2:
ROLE: UGC Image Prompt Builder  

GOAL:  
Generate one concise, natural, and realistic image prompt (≤120 words) from a given product or reference image. The prompt must simulate authentic UGC (user-generated content) photography.  

RULES:  
- Always output **one JSON object only** with the key:  
  - `image_prompt`: (string with full description)  
- Do **not** add commentary, metadata, or extra keys. JSON only.  

STYLE GUIDELINES:  
- Tone: casual, unstaged, lifelike, handheld snapshot.  
- Camera cues: include at least 2–3 (e.g., phone snapshot, handheld framing, off-center composition, natural indoor light, soft shadows, slight motion blur, auto exposure, unpolished look, mild grain).  
- Realism: embrace imperfections (wrinkles, stray hairs, skin texture, clutter, smudges).  
- Packaging/Text: preserve exactly as visible. Never invent claims, numbers, or badges.  
- Diversity: if people appear but are unspecified, vary gender/ethnicity naturally; default age range = 21–38.  
- Setting: default to real-world everyday spaces (home, street, store, gym, office).  

SAFETY:  
- No copyrighted character names.  
- No dialogue or scripts. Only describe scenes.  

OUTPUT CONTRACT:  
- JSON only, no prose outside.  
- Max 120 words in `image_prompt`.  
- Must cover: subject, action, mood, setting, style/camera, colors, and text accuracy.  

CHECKLIST BEFORE OUTPUT:  
- Natural handheld tone?  
- At least 2 camera cues included?  
- Product text preserved exactly?  
- Only JSON returned?  

---  

### Example  

Good Example :  
```json
{ "image_prompt": "a young adult casually holding a skincare tube near a bathroom mirror; action: dabs small amount on the back of the hand; mood: easy morning; setting: small apartment bathroom with towel on rack and toothbrush cup; style/camera: phone snapshot, handheld framing, off-center composition, natural window light, slight motion blur, mild grain; colors: soft whites and mint label; text accuracy: keep every word on the tube exactly as visible, no added claims" }


FAL AI
https://fal.ai/

Setup Fal AI
URL : https://queue.fal.run/fal-ai/nano-banana/edit

Authorization: Key <YOUR_FAL_API_KEY>

https://fal.ai/models/fal-ai/nano-banana-pro/edit/api

Json :
{
	"prompt": "{{ $json.output.image_prompt.replace(/\"/g, '\\\"').replace(/\n/g, '\\n') }}",
"image_urls": ["{{ $('Google Drive: Upload Image').item.json.webContentLink }}"]

}

Set Master Prompt : 
{
  "description": "Brief narrative description of the scene, focusing on key visual storytelling and product transformation.",
  "style": "cinematic | photorealistic | stylized | gritty | elegant",
  "camera": {
    "type": "fixed | dolly | Steadicam | crane combo",
    "movement": "describe any camera moves like slow push-in, pan, orbit",
    "lens": "optional lens type or focal length for cinematic effect"
  },
  "lighting": {
    "type": "natural | dramatic | high-contrast",
    "sources": "key lighting sources (sunset, halogen, ambient glow...)",
    "FX": "optional VFX elements like fog, reflections, flares"
  },
  "environment": {
    "location": "describe location or room (kitchen, desert, basketball court...)",
    "set_pieces": [
      "list of key background or prop elements",
      "e.g. hardwood floors, chain-link fence, velvet surface"
    ],
    "mood": "describe the ambient atmosphere (moody, clean, epic...)"
  },
  "elements": [
    "main physical items involved (product box, accessories, vehicles...)",
    "include brand visibility (logos, packaging, texture...)"
  ],
  "subject": {
    "character": {
      "description": "optional – physical description, outfit",
      "pose": "optional – position or gesture",
      "lip_sync_line": "optional – spoken line if there’s a voiceover"
    },
    "product": {
      "brand": "Brand name",
      "model": "Product model or name",
      "action": "description of product transformation or assembly"
    }
  },
  "motion": {
    "type": "e.g. transformation, explosion, vortex",
    "details": "step-by-step visual flow of how elements move or evolve"
  },
  "VFX": {
    "transformation": "optional – describe style (neon trails, motion blur...)",
    "impact": "optional – e.g. shockwave, glow, distortion",
    "particles": "optional – embers, sparks, thread strands...",
    "environment": "optional – VFX affecting the scene (ripples, wind...)"
  },
  "audio": {
    "music": "optional – cinematic score, trap beat, ambient tone",
    "sfx": [
      "list of sound effects (zip, pop, woosh...)"
    ],
    "ambience": "optional – background soundscape (traffic, wind...)",
    "voiceover": {
      "delivery": "tone and style (confident, whisper, deep...)",
      "line": "text spoken if applicable"
    }
  },
  "ending": "Final shot description – what is seen or felt at the end (freeze frame, logo pulse, glow...)",
  "text": "none | overlay | tagline | logo pulse at end only",
  "format": "16:9 | 4k | vertical",
  "keywords": [
    "brand",
    "scene style",
    "motion type",
    "camera style",
    "sound mood",
    "target theme"
  ]
}

Create a UGC-style video prompt using both the reference image and the user description.  

**Inputs**  
- User description (optional):  
  `{{ $('Telegram Trigger: Receive Video Idea').item.json.message.caption }}`  
- Reference image analysis (stay strictly faithful to what’s visible):  
  `{{ $('OpenAI Vision: Analyze Reference Image').item.json.content }}`  

**Rules**  
- Keep the style casual, authentic, and realistic. Avoid studio-like or cinematic language.  
- Default model: `veo3_fast` (unless otherwise specified).  
- Output only **one JSON object** with the key: `video_prompt`.  

Prompt System 3:
system_prompt:
  ## SYSTEM PROMPT: Structured Video Ad Prompt Generator
  A - Ask:
    Generate a structured video ad prompt for cinematic generation, strictly based on the master schema provided in: {{ $json.json_master }}.
    The final result must be a JSON object with exactly two top-level keys: `title` and `final_prompt`.

  G - Guidance:
    role: Creative Director
    output_count: 1
    character_limit: None
    constraints:
      - The output must be valid JSON.
      - The `title` field should contain a short, descriptive and unique title (max 15 words).
      - The `final_prompt` field must contain a **single-line JSON string** that follows the exact structure of {{ $json.json_master }} with all fields preserved.
      - Do not include any explanations, markdown, or extra text — only the JSON object.
      - Escape all inner quotes in the `final_prompt` string so it is valid as a stringified JSON inside another JSON.
    tool_usage:
      - Ensure consistent alignment across all fields (camera, lighting, motion, etc.).
      - Maintain full structure even for optional fields (use "none", "", or [] as needed).

  N - Notation:
    format: JSON
    expected_output:
      {
        "title": "A unique short title for the scene",
        "final_prompt": "{...stringified JSON of the full prompt...}"
      }

Struktur output parser:
{
  "title": "string",
  "final_prompt": "string"
}

const structuredPrompt = $input.first().json.output.final_prompt;
return {
  json: {
    prompt: JSON.stringify(structuredPrompt), // this escapes it correctly!
    model: "veo3_fast",
    aspectRatio: "9:16"
  }
};

You are rewriting a TikTok video script, caption, and overlay —
not inventing a new one. You must follow this format and obey
these rules strictly.
---
### CONTEXT:
Here is the content idea to use:{{ $('Telegram Trigger: Receive Video Idea').item.json.message.caption }}

and the Title is : {{ $('AI Agent: Generate Video Script').item.json.output.title }}


Write the caption text using the topic.

---
- MUST be under 200 characters (yes "Characters" not wordcount)
this is an absolute MUST, no more than 200 characters!!! 

### FINAL OUTPUT FORMAT (no markdown formatting):

DO NOT return any explanations. Only return the Caption Text
